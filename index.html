<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bikom Axel - AI Tutor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #020617; /* Deepest black-slate */
            color: #f8fafc;
        }

        .chat-container::-webkit-scrollbar {
            width: 5px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background-color: #1e293b;
            border-radius: 10px;
        }

        .sidebar-dark {
            background-color: #020617;
            border-right: 1px solid #1e293b;
        }

        .message-bubble-bot {
            background: #0f172a;
            border: 1px solid #1e293b;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        }

        .message-bubble-user {
            background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
        }

        .gradient-bg {
            background: radial-gradient(circle at top right, #1e1b4b 0%, #020617 50%);
        }

        .input-glass {
            background: #0f172a;
            border: 1px solid #1e293b;
        }

        .input-glass:focus-within {
            border-color: #6366f1;
            box-shadow: 0 0 0 1px #6366f1;
        }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden gradient-bg">

    <!-- Sidebar (Desktop) -->
    <aside class="hidden md:flex flex-col w-72 sidebar-dark">
        <div class="p-6 border-b border-slate-800">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-2.5 rounded-xl shadow-lg shadow-indigo-900/50 text-white">
                    <i data-lucide="sparkles" class="w-6 h-6"></i>
                </div>
                <h1 class="font-bold text-xl tracking-tight text-white">Bikom Axel</h1>
            </div>
        </div>

        <div class="p-6 space-y-8 flex-1">
            <div>
                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em] mb-4 block">Learning Mode</label>
                <div class="space-y-2">
                    <button onclick="changeMode('SOCRATIC')" id="btn-SOCRATIC" class="mode-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all bg-indigo-600/20 text-indigo-400 font-semibold border border-indigo-500/30">
                        <i data-lucide="message-circle" class="w-4 h-4"></i>
                        <span class="text-sm">Socratic Tutor</span>
                    </button>
                    <button onclick="changeMode('EXAM_PREP')" id="btn-EXAM_PREP" class="mode-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-slate-900 font-medium">
                        <i data-lucide="book-open" class="w-4 h-4"></i>
                        <span class="text-sm">Exam Prep</span>
                    </button>
                    <button onclick="changeMode('SUMMARIZER')" id="btn-SUMMARIZER" class="mode-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-slate-900 font-medium">
                        <i data-lucide="zap" class="w-4 h-4"></i>
                        <span class="text-sm">Summarizer</span>
                    </button>
                </div>
            </div>

            <div class="p-4 bg-slate-900/50 border border-slate-800 rounded-2xl text-slate-300 relative overflow-hidden">
                <div class="relative z-10">
                    <p class="text-xs font-semibold text-indigo-400 mb-1">Study Tip</p>
                    <p class="text-sm leading-relaxed">Ask Bikom Axel "Why" a concept works to build deeper mental models.</p>
                </div>
                <i data-lucide="lightbulb" class="absolute -right-2 -bottom-2 w-16 h-16 opacity-5"></i>
            </div>
        </div>
        
        <div class="p-6 border-t border-slate-800">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-slate-900 border border-slate-800 flex items-center justify-center text-slate-400">
                    <i data-lucide="user" class="w-5 h-5"></i>
                </div>
                <div>
                    <p class="text-sm font-bold text-slate-200">Student Portal</p>
                    <p class="text-xs text-indigo-500 font-medium">Online & Secure</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="flex-1 flex flex-col relative h-full">
        <!-- Mobile Header -->
        <header class="md:hidden bg-slate-950/80 backdrop-blur-md border-b border-slate-800 px-6 py-4 flex items-center justify-between sticky top-0 z-20">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-1.5 rounded-lg text-white">
                    <i data-lucide="sparkles" class="w-5 h-5"></i>
                </div>
                <h1 class="font-bold text-lg text-white">Bikom Axel</h1>
            </div>
            <select onchange="changeMode(this.value)" class="bg-slate-900 border border-slate-800 text-slate-300 text-xs font-bold rounded-lg px-2 py-1.5 outline-none">
                <option value="SOCRATIC">Socratic</option>
                <option value="EXAM_PREP">Exam Prep</option>
                <option value="SUMMARIZER">Summarizer</option>
            </select>
        </header>

        <!-- Messages Area -->
        <div id="chat-box" class="chat-container flex-1 overflow-y-auto p-4 md:p-10 space-y-8">
            <!-- Bot Welcome -->
            <div class="flex justify-start animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div class="flex max-w-[85%] md:max-w-[75%] gap-4">
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0 bg-slate-900 border border-indigo-500/20 text-indigo-400 shadow-sm">
                        <i data-lucide="bot" class="w-6 h-6"></i>
                    </div>
                    <div class="p-5 rounded-2xl rounded-tl-none message-bubble-bot text-slate-200">
                        <p class="text-sm md:text-base leading-relaxed">Hi! I'm <b>Bikom Axel</b>, your upgraded AI tutor. I'm now powered by the ultra-stable Gemini 1.5 core. What shall we learn today?</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Typing Indicator -->
        <div id="typing-indicator" class="hidden px-10 pb-4 flex items-center gap-2">
            <div class="flex gap-1">
                <span class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce"></span>
                <span class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                <span class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce" style="animation-delay: 0.4s"></span>
            </div>
            <span class="text-xs font-medium text-slate-500 italic">Bikom Axel is reflecting...</span>
        </div>

        <!-- Input Section -->
        <div class="px-4 pb-4 md:px-10 md:pb-8">
            <div class="max-w-4xl mx-auto">
                <div class="relative flex items-end gap-2 input-glass rounded-2xl p-2 shadow-2xl transition-all group">
                    <textarea id="user-input" placeholder="Ask Bikom Axel a question..." class="flex-1 bg-transparent border-none p-3 outline-none resize-none text-slate-200 placeholder:text-slate-600 text-sm md:text-base min-h-[48px] max-h-[150px]" rows="1"></textarea>
                    <button id="send-btn" class="p-3 rounded-xl bg-slate-800 text-slate-500 transition-all hover:scale-105 active:scale-95 disabled:opacity-50">
                        <i data-lucide="send-horizontal" class="w-5 h-5"></i>
                    </button>
                </div>
                <p class="text-[10px] text-center text-slate-600 mt-4 font-medium tracking-wide">
                    BIKOM AXEL INTELLECTUAL INTERFACE ‚Ä¢ CORE V2.1 (STABILIZED)
                </p>
            </div>
        </div>
    </main>

    <script>
        /**
         * ‚ö†Ô∏è API KEY CONFIGURATION:
         * Ensure you have pasted your key between the quotes below.
         */
        const API_KEY = "AIzaSyBzbrEhGu3K8tU9mO1VtREZL9SdjMTdVd8"; 
        
        // Switched to Gemini 1.5 Flash for maximum reliability and stability across all regions
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent";

        const MODES = {
            SOCRATIC: "Your name is Bikom Axel. You are a world-class Socratic tutor. Your goal is to help the student reach the answer through logic. NEVER give answers directly. Instead, break down complex thoughts into tiny, manageable questions. If a student is stuck, give a hint using an analogy. Be warm, professional, and intellectually stimulating.",
            EXAM_PREP: "Your name is Bikom Axel. You are an expert exam strategist. Help the student identify weak points in their knowledge, provide mock questions, and give feedback on their reasoning. Use pedagogical techniques like spaced repetition concepts.",
            SUMMARIZER: "Your name is Bikom Axel. You synthesize complex information into clear, hierarchical summaries. Use bullet points, bold text for key terms, and explain jargon simply."
        };

        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');

        let currentMode = "SOCRATIC";
        let chatHistory = []; 

        lucide.createIcons();

        function changeMode(modeKey) {
            currentMode = modeKey;
            chatHistory = []; 
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-600/20', 'text-indigo-400', 'border-indigo-500/30', 'border', 'font-semibold');
                btn.classList.add('text-slate-400', 'font-medium');
            });

            const activeBtn = document.getElementById(`btn-${modeKey}`);
            if(activeBtn) {
                activeBtn.classList.add('bg-indigo-600/20', 'text-indigo-400', 'border-indigo-500/30', 'border', 'font-semibold');
                activeBtn.classList.remove('text-slate-400', 'font-medium');
            }

            appendMessage('bot', `System recalibrated. I am now in **${modeKey.replace('_', ' ')}** mode. My memory has been cleared for this session. What's our first objective?`);
        }

        function appendMessage(role, text) {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-in fade-in slide-in-from-bottom-4 duration-300`;
            
            const isUser = role === 'user';
            
            const content = `
                <div class="flex max-w-[85%] md:max-w-[75%] gap-4 ${isUser ? 'flex-row-reverse' : 'flex-row'}">
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0 shadow-sm ${isUser ? 'bg-indigo-600 text-white' : 'bg-slate-900 border border-slate-800 text-indigo-400'}">
                        <i data-lucide="${isUser ? 'user' : 'bot'}" class="w-6 h-6"></i>
                    </div>
                    <div class="p-5 rounded-2xl ${isUser ? 'rounded-tr-none message-bubble-user text-white font-medium' : 'rounded-tl-none message-bubble-bot text-slate-200'}">
                        <p class="text-sm md:text-base leading-relaxed whitespace-pre-wrap">${text}</p>
                    </div>
                </div>
            `;
            div.innerHTML = content;
            chatBox.appendChild(div);
            lucide.createIcons();
            chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
        }

        async function fetchAIResponse(userText, retries = 0) {
            if (!API_KEY || API_KEY.trim() === "") {
                return "‚ö†Ô∏è **Bikom Axel Offline**: An API key is required in the code (line 133). Please check your GitHub source file.";
            }

            const contents = [
                ...chatHistory,
                { role: "user", parts: [{ text: userText }] }
            ];

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: contents,
                        systemInstruction: { parts: [{ text: MODES[currentMode] }] },
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 1024,
                        }
                    })
                });

                if (response.status === 429 && retries < 5) {
                    const delay = Math.pow(2, retries) * 1000;
                    await new Promise(r => setTimeout(r, delay));
                    return fetchAIResponse(userText, retries + 1);
                }

                if (!response.ok) {
                    const errorData = await response.json();
                    return `‚ùå **Connection Error (${response.status})**: ${errorData.error?.message || 'The AI service is currently unavailable.'}`;
                }

                const data = await response.json();
                
                const aiResponseText = data.candidates?.[0]?.content?.parts?.[0]?.text || "I processed your request but couldn't formulate a response. Please try rephrasing.";
                
                chatHistory.push({ role: "user", parts: [{ text: userText }] });
                chatHistory.push({ role: "model", parts: [{ text: aiResponseText }] });

                if (chatHistory.length > 20) chatHistory = chatHistory.slice(-20);

                return aiResponseText;

            } catch (error) {
                return "üì° **Signal Lost**: I couldn't reach the thinking core. Please check your internet connection or verify the API key is active.";
            }
        }

        async function handleSend() {
            const text = userInput.value.trim();
            if (!text) return;

            userInput.value = '';
            userInput.style.height = 'auto';
            sendBtn.disabled = true;
            appendMessage('user', text);

            typingIndicator.classList.remove('hidden');
            chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });

            const aiText = await fetchAIResponse(text);
            
            typingIndicator.classList.add('hidden');
            appendMessage('bot', aiText);
            sendBtn.disabled = false;
        }

        sendBtn.addEventListener('click', handleSend);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });

        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
            
            if (this.value.trim()) {
                sendBtn.classList.add('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/50');
                sendBtn.classList.remove('bg-slate-800', 'text-slate-500');
            } else {
                sendBtn.classList.remove('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/50');
                sendBtn.classList.add('bg-slate-800', 'text-slate-500');
            }
        });
    </script>
</body>
</html>
